# –ó–ê–î–ê–ß–ò –ü–†–û–ï–ö–¢–ê AI D&D MASTER

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-09-11  
**–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º**: BUILD MODE - –ì–æ–ª–æ—Å–æ–≤–∞—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞  
**–ê–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞**: –≠—Ç–∞–ø 2 –∑–∞–≤–µ—Ä—à–µ–Ω, –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≠—Ç–∞–ø—É 3

## ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### üéôÔ∏è –≠–¢–ê–ü 2: VoiceChat UI Integration (–ó–ê–í–ï–†–®–ï–ù)
**–¶–µ–ª—å**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤—É—é —Å–≤—è–∑—å –≤ –æ—Å–Ω–æ–≤–Ω—É—é –∏–≥—Ä–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É

#### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- [x] **VoicePanel** - –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
- [x] **useVoiceChat Hook** - –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑ voice-test —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- [x] **ParticipantItem** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å volume controls
- [x] **VolumeSlider** - –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π)
- [x] **VoiceControls** - –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–π —Å–≤—è–∑—å—é
- [x] **SpeakingIndicator** - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

#### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `/room/[id]` –±–µ–∑ breaking changes
- [x] Volume controls –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (0-100%)
- [x] –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (0%, 50%, 100%)
- [x] –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ localStorage
- [x] –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å —Å collapsible –ø–∞–Ω–µ–ª—å—é
- [x] Real-time audio volume —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- [x] –úute/unmute —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [x] Speaking indicators —Å WebRTC integration

#### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π SignalingService (–ø–æ—Ä—Ç 8001)
- –°–ª–µ–¥—É–µ—Ç Style Guide —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–µ
- Volume state management —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Chrome/Safari WebRTC

## üéØ –ê–ö–¢–ò–í–ù–´–ï –ó–ê–î–ê–ß–ò

### üîä –≠–¢–ê–ü 3: TTS Integration (–í –ü–õ–ê–ù–ê–•)
**–¶–µ–ª—å**: –î–æ–±–∞–≤–∏—Ç—å Text-to-Speech –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–∑–≤—É—á–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –ò–ò-–º–∞—Å—Ç–µ—Ä–∞
**–í—Ä–µ–º—è**: 1.5 —á–∞—Å–∞

#### üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
- [ ] **TTSManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TTS providers –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [ ] **AzureTTSProvider** - –æ—Å–Ω–æ–≤–Ω–æ–π TTS –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- [ ] **CacheManager** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ TTS —Ñ–∞–π–ª–æ–≤
- [ ] **TTSPlayer** - frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DMAgentWithMemoryService

#### üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è TTS –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –ò–ò-–º–∞—Å—Ç–µ—Ä–∞
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ TTS —Ñ–∞–π–ª–æ–≤ (30 –¥–Ω–µ–π TTL)
- [ ] Multi-provider –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (Azure primary, Google fallback)
- [ ] TTS controls –≤ VoicePanel (–≤–∫–ª/–≤—ã–∫–ª)
- [ ] Priority-based audio mixing

### üéõÔ∏è –≠–¢–ê–ü 4: Audio State Management (–í –ü–õ–ê–ù–ê–•)
**–¶–µ–ª—å**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞–º–∏
**–í—Ä–µ–º—è**: 1 —á–∞—Å

#### üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- [ ] **AudioStateManager** - priority-based –ª–æ–≥–∏–∫–∞
- [ ] **useAudioState** - frontend audio context
- [ ] Auto-ducking –ø—Ä–∏ TTS –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏
- [ ] Smooth transitions –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### Environment Variables (–¥–ª—è Stage 3-4):
```bash
# TTS Configuration
TTS_PROVIDER=azure
TTS_API_KEY=your_api_key_here
TTS_VOICE_DM=en-US-AriaNeural
TTS_CACHE_DIR=./data/tts-cache
TTS_CACHE_TTL=2592000  # 30 days

# Voice Features
VOICE_ENABLED=true
TTS_ENABLED=true
AUTO_TTS_DM=false
MAX_VOICE_PARTICIPANTS=6
```

### API Endpoints (–¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏):
```typescript
GET  /api/voice/status           # –°—Ç–∞—Ç—É—Å –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã
POST /api/voice/rooms/:id/join   # –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É —á–∞—Ç—É
POST /api/voice/tts/generate     # –†—É—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è TTS
GET  /api/voice/settings         # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
PUT  /api/voice/settings         # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ (Stage 2):
- [x] Voice connection –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- [x] Volume controls —Å real-time –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- [x] localStorage persistence –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [x] –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
- [x] WebRTC signaling stability
- [x] UI integration –±–µ–∑ breaking changes

### üìã –¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Stage 3-4):
- [ ] TTS generation –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
- [ ] Audio priority —Å–∏—Å—Ç–µ–º–∞
- [ ] Auto-ducking —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] Cache management
- [ ] Multi-browser TTS compatibility

## üéØ ACCEPTANCE CRITERIA

### ‚úÖ Stage 2 (–ó–∞–≤–µ—Ä—à–µ–Ω):
- [x] 4+ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É —á–∞—Ç—É
- [x] VoicePanel –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è UI
- [x] Volume controls –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- [x] –ú–æ–±–∏–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### üìã Stage 3-4 (–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç):
- [ ] –ò–ò-–º–∞—Å—Ç–µ—Ä –æ–∑–≤—É—á–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ TTS
- [ ] Audio priority —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Performance: TTS generation < 3 —Å–µ–∫
- [ ] Audio state transitions < 100ms

## üìä –ú–ï–¢–†–ò–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### ‚úÖ –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- Voice connection establishment: < 5 —Å–µ–∫—É–Ω–¥ ‚úÖ
- UI responsiveness: –±–µ–∑ lag ‚úÖ
- Volume control latency: < 50ms ‚úÖ
- Memory usage: –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ ‚úÖ

### üìã –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (Stage 3-4):
- TTS generation: < 3 —Å–µ–∫—É–Ω–¥
- Audio state transitions: < 100ms
- Cache hit rate: > 80%
- Concurrent TTS + Voice: —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

